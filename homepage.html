<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HolDex | The Terminal Fire Explorer</title>
    
    <!-- ========================================== -->
    <!-- 1. ESSENTIAL LIBRARIES                     -->
    <!-- ========================================== -->
    
    <!-- 1. Buffer (Browser Compatible) -->
    <script src="https://bundle.run/buffer@6.0.3"></script>
    <script>
        // Expose Buffer globally for any legacy dependency
        if (typeof window.buffer !== 'undefined') {
            window.Buffer = window.buffer.Buffer;
        }
    </script>

    <!-- 2. Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@1.91.0/lib/index.iife.min.js"></script>

    <!-- 3. Lightweight Charts (TradingView) - PINNED VERSION for Stability -->
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>

    <!-- 4. Styling & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        fire: { bg: '#2a1005', panel: '#451a03', border: '#7c2d12', accent: '#ea580c', text: '#ffedd5', highlight: '#fb923c' },
                        void: '#0f0502'
                    },
                    fontFamily: { mono: ['JetBrains Mono', 'monospace'], sans: ['Comic Neue', 'cursive'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #2a1005; color: #ffedd5; font-family: 'Comic Neue', cursive; min-height: 100vh; font-size: 14px; overflow-x: hidden; padding-bottom: 60px; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #2a1005; }
        ::-webkit-scrollbar-thumb { background: #7c2d12; border-radius: 4px; border: 1px solid #451a03; }
        ::-webkit-scrollbar-thumb:hover { background: #ea580c; }
        nav { background: rgba(42, 16, 5, 0.95); backdrop-filter: blur(12px); border-bottom: 2px solid #7c2d12; }
        .brand-text { color: #ea580c; text-shadow: 2px 2px 0px #451a03; font-weight: 800; letter-spacing: 1px; }
        .holdex-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .holdex-table th { background: #451a03; position: sticky; top: 0; z-index: 20; padding: 14px 12px; text-align: right; font-size: 12px; font-weight: 700; color: #fb923c; border-bottom: 2px solid #7c2d12; cursor: pointer; white-space: nowrap; text-transform: uppercase; transition: color 0.2s, background 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .holdex-table th:hover { background: #582206; color: #fff; }
        .holdex-table th:first-child { text-align: left; padding-left: 20px; }
        .holdex-table td { padding: 12px 12px; border-bottom: 1px solid rgba(124, 45, 18, 0.3); vertical-align: middle; font-family: 'JetBrains Mono', monospace; }
        .holdex-table td:first-child { padding-left: 20px; }
        .holdex-table tr:hover td { background: rgba(234, 88, 12, 0.1); }
        .img-token { width: 40px; height: 40px; border-radius: 8px; border: 2px solid #7c2d12; object-fit: cover; flex-shrink: 0; background: #000; }
        .pill { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; font-family: 'JetBrains Mono'; }
        .pill-green { background: rgba(34, 197, 94, 0.15); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.4); }
        .pill-red { background: rgba(239, 68, 68, 0.15); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
        .search-container { position: relative; width: 100%; }
        .search-box { background: #451a03; border: 2px solid #7c2d12; color: #fb923c; padding: 10px 36px 10px 16px; border-radius: 8px; outline: none; width: 100%; font-family: 'JetBrains Mono'; transition: border-color 0.2s; }
        .search-box:focus { border-color: #ea580c; }
        .search-box::placeholder { color: #9a3412; }
        .clear-search { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #9a3412; cursor: pointer; display: none; }
        .clear-search:hover { color: #ea580c; }
        .nav-btn { background: transparent; color: #9a3412; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 800; transition: all 0.2s; border: 2px solid transparent; }
        .nav-btn:hover { color: #fb923c; }
        .nav-btn.active { background: #451a03; color: #ea580c; border-color: #7c2d12; box-shadow: 0 4px 0 #2a1005; }
        .filter-toggle { background: #451a03; border: 2px solid #7c2d12; color: #9a3412; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 700; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .filter-toggle.active { border-color: #22c55e; color: #4ade80; background: rgba(34, 197, 94, 0.1); }
        .refresh-btn { background: #451a03; border: 2px solid #7c2d12; color: #fb923c; width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative; }
        .refresh-btn:hover:not(:disabled) { border-color: #ea580c; color: #fff; background: #582206; }
        .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #451a03; color: #7c2d12; }
        .refresh-btn:disabled i { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .page-btn { background: #2a1005; border: 2px solid #7c2d12; color: #fb923c; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-family: 'JetBrains Mono', monospace; transition: all 0.2s; cursor: pointer; }
        .page-btn:hover:not(:disabled) { border-color: #ea580c; color: #fff; background: #451a03; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #451a03; color: #7c2d12; }
        .view-section { display: none; }
        .view-section.active { display: block; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* NEW CHART STYLES */
        .chart-wrapper { width: 100%; height: 500px; background: #1a0a05; border-radius: 16px; overflow: hidden; border: 2px solid #7c2d12; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .chart-header { padding: 8px 16px; background: #2a1005; border-bottom: 1px solid #7c2d12; display: flex; justify-content: space-between; align-items: center; }
        .res-btn { background: transparent; border: 1px solid transparent; color: #9a3412; padding: 4px 8px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 11px; font-weight: bold; cursor: pointer; transition: all 0.1s; }
        .res-btn:hover { color: #fb923c; border-color: #451a03; }
        .res-btn.active { background: #451a03; color: #ea580c; border-color: #7c2d12; }
        #tv-chart { flex: 1; position: relative; width: 100%; height: 100%; }

        .stat-card { background: rgba(69, 26, 3, 0.8); border: 2px solid #7c2d12; border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 4px; box-shadow: 4px 4px 0 rgba(0,0,0,0.2); }
        .stat-label { font-size: 11px; color: #fb923c; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; }
        .stat-value { font-size: 18px; font-weight: 700; color: #fff; font-family: 'JetBrains Mono'; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 5, 2, 0.95); backdrop-filter: blur(5px); z-index: 100; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .status-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #451a03; border-top: 2px solid #ea580c; padding: 0 16px; height: 50px; display: flex; justify-content: space-between; align-items: center; z-index: 50; transition: background 0.2s; box-shadow: 0 -5px 20px rgba(234, 88, 12, 0.2); }
        .status-bar:hover { background: #582206; }
        .pulse-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-left: 8px; border: 1px solid rgba(255,255,255,0.2); }
        .pulse-dot.green { background: #22c55e; box-shadow: 0 0 12px #22c55e; animation: pulseGlow 2s infinite; }
        .pulse-dot.red { background: #ef4444; box-shadow: 0 0 12px #ef4444; }
        @keyframes pulseGlow { 0% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { opacity: 1; box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        .action-btn { background: #451a03; border: 2px solid #ea580c; color: #fb923c; padding: 12px 20px; border-radius: 12px; font-weight: 700; text-transform: uppercase; font-size: 13px; transition: all 0.2s; box-shadow: 4px 4px 0 #7c2d12; }
        .action-btn:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0 #7c2d12; background: #582206; color: #fff; }
        .action-btn:active { transform: translate(2px, 2px); box-shadow: 0 0 0; }
        .back-btn { background: #2a1005; border: 2px solid #7c2d12; color: #9a3412; padding: 10px 16px; border-radius: 8px; font-weight: 700; transition: all 0.2s; }
        .back-btn:hover { border-color: #ea580c; color: #ea580c; }
        .sort-header { position: relative; }
        .sort-header:active { transform: translateY(1px); }
        .table-scroll-container { max-height: 70vh; overflow-y: auto; border-radius: 0 0 16px 16px; }
        .form-input { background: #451a03; border: 2px solid #7c2d12; color: #fb923c; padding: 12px; border-radius: 8px; width: 100%; font-family: 'JetBrains Mono'; margin-bottom: 16px; outline: none; transition: border-color 0.2s; }
        .form-input:focus { border-color: #ea580c; }
        .form-label { display: block; color: #9a3412; font-size: 12px; font-weight: bold; margin-bottom: 6px; text-transform: uppercase; }
        .social-btn { display: flex; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 12px; border: 2px solid #7c2d12; background: #451a03; color: #ea580c; transition: all 0.2s; }
        .social-btn:hover { border-color: #ea580c; color: #fff; background: #582206; transform: translateY(-2px); }
        .pool-tab { padding: 8px 16px; font-size: 12px; font-weight: bold; color: #9a3412; cursor: pointer; border-bottom: 2px solid transparent; }
        .pool-tab.active { color: #ea580c; border-bottom-color: #ea580c; }
        .pool-tab:hover:not(.active) { color: #fb923c; }
        .verified-badge { display: inline-flex; align-items: center; justify-content: center; background: rgba(34, 197, 94, 0.15); border: 1px solid #22c55e; color: #22c55e; border-radius: 50%; width: 20px; height: 20px; margin-left: 6px; box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
        .verified-badge i { width: 12px; height: 12px; }
        .info-btn { color: #9a3412; cursor: pointer; transition: color 0.2s; }
        .info-btn:hover { color: #fb923c; }
        .info-box { background: #451a03; border: 1px solid #7c2d12; border-radius: 8px; padding: 16px; margin-bottom: 16px; color: #ffedd5; font-size: 13px; line-height: 1.5; }
        .info-box a { color: #fb923c; text-decoration: underline; }
        .preview-content { max-height: 80vh; overflow-y: auto; padding: 20px; }
        .feature-box { background: #451a03; border: 2px solid #7c2d12; border-radius: 16px; padding: 24px; transition: transform 0.2s; display: flex; flex-direction: column; gap: 8px; }
        .feature-box:hover { border-color: #ea580c; transform: translateY(-4px); }
        .connect-btn { background: #581c87; border: 2px solid #a855f7; color: white; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .connect-btn:hover { background: #6b21a8; box-shadow: 0 0 15px rgba(168, 85, 247, 0.4); }
        .fee-card { background: rgba(0,0,0,0.3); border: 1px dashed #7c2d12; padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center; }
        
        .wallet-btn { background: #2a1005; border: 2px solid #7c2d12; padding: 16px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all 0.2s; color: #ffedd5; font-weight: bold; }
        .wallet-btn:hover { border-color: #ea580c; background: #451a03; transform: translateX(5px); }
        .wallet-icon { width: 32px; height: 32px; border-radius: 8px; }
        
        .status-bar-btn { padding: 6px 12px; border-radius: 6px; border: 1px solid #7c2d12; background: #2a1005; color: #9a3412; font-size: 11px; font-weight: bold; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; white-space: nowrap; }
        .status-bar-btn:hover { border-color: #ea580c; color: #fb923c; background: #451a03; }
        .status-bar-btn.connected { border-color: #22c55e; color: #22c55e; background: rgba(34, 197, 94, 0.1); }
        
        /* Large social buttons for detail view */
        .social-btn-lg { display: flex; align-items: center; justify-content: center; width: 56px; height: 56px; border-radius: 14px; border: 2px solid #7c2d12; background: #451a03; color: #ea580c; transition: all 0.2s; }
        .social-btn-lg:hover { border-color: #ea580c; color: #fff; background: #582206; transform: translateY(-2px); }

        /* API Code Block Styles */
        .code-block { background: #0f0502; border: 1px solid #7c2d12; padding: 16px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #fb923c; overflow-x: auto; position: relative; }
        .code-copy-btn { position: absolute; top: 8px; right: 8px; background: #451a03; border: 1px solid #7c2d12; color: #9a3412; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; transition: all 0.2s; }
        .code-copy-btn:hover { border-color: #ea580c; color: #fff; }
    </style>
</head>
<body>

<nav class="sticky top-0 z-40">
    <div class="max-w-[1800px] mx-auto px-4 md:px-6 py-4 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
        <div class="flex items-center justify-between w-full md:w-auto">
            <div class="flex items-center gap-4 cursor-pointer group" onclick="navigateTo('')">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center bg-[#451a03] text-orange-500 border-2 border-[#7c2d12] shadow-lg group-hover:border-orange-500 transition">
                    <i data-lucide="flame" width="24"></i>
                </div>
                <div>
                    <h1 class="text-3xl brand-text tracking-tight font-sans">HolDex</h1>
                </div>
            </div>
        </div>

        <div class="flex items-center bg-[#451a03]/50 p-1 rounded-lg border border-[#7c2d12]/50">
            <button class="nav-btn active" onclick="navigateTo('')">Home</button>
            <button class="nav-btn" onclick="navigateTo('about')">About</button>
            <button class="nav-btn" onclick="navigateTo('update')">Update</button>
        </div>
        
        <div id="table-controls" class="flex items-center gap-3 w-full md:w-auto transition-opacity duration-300">
            <!-- Filter: Verified -->
            <button id="filter-verified" onclick="toggleVerifiedFilter()" class="filter-toggle" title="Show only Verified Community Updates">
                <i data-lucide="shield-check" width="16"></i> Verified Only
            </button>
            
            <!-- Filter: Zero Vol (NEW) - Active by default -->
            <button id="filter-zerovol" onclick="toggleZeroVolFilter()" class="filter-toggle active" title="Hide tokens with 0 Volume">
                <i data-lucide="bar-chart-2" width="16"></i> Hide 0 Vol
            </button>

            <!-- Search with Clear Button -->
            <div class="relative w-full md:w-auto search-container">
                <input type="text" id="search" placeholder="Search..." class="search-box" onkeyup="handleSearch(event)">
                <i id="clear-search-btn" data-lucide="x" width="16" class="clear-search" onclick="clearSearch()"></i>
            </div>

            <button id="manual-refresh" onclick="handleManualRefresh()" class="refresh-btn" title="Refresh Data">
                <i data-lucide="refresh-cw" width="18"></i>
            </button>
        </div>

        <div id="detail-controls" class="hidden w-full md:w-auto">
            <button onclick="navigateTo('')" class="back-btn flex items-center justify-center gap-2 w-full md:w-auto"><i data-lucide="arrow-left" width="16"></i> Back</button>
        </div>
    </div>
</nav>

<main class="max-w-[1800px] mx-auto px-0 md:px-6 py-4 md:py-8">
    
    <!-- DASHBOARD VIEW -->
    <div id="view-dashboard" class="view-section active">
        <div class="bg-[#2a1005] border-y md:border-2 border-[#7c2d12] md:rounded-2xl overflow-hidden shadow-2xl flex flex-col">
            <div class="table-scroll-container overflow-x-auto">
                <table class="holdex-table">
                    <thead>
                        <tr>
                            <th width="40%" class="sort-header" onclick="setSort('newest')">Asset <i data-lucide="arrow-down-up" width="10" class="inline opacity-50 ml-1"></i></th>
                            <th class="sort-header text-[#ea580c] border-b-[#ea580c] border-b-2" onclick="setSort('kscore')">K-Score</th>
                            <th class="hidden md:table-cell sort-header" onclick="setSort('5m')">5m</th>
                            <th class="hidden md:table-cell sort-header" onclick="setSort('1h')">1h</th>
                            <th class="sort-header" onclick="setSort('24h')">24h</th>
                            <th class="sort-header" onclick="setSort('mcap')">Mkt Cap</th>
                            <th class="sort-header" onclick="setSort('volume')">Vol (24h)</th> 
                            <th class="hidden md:table-cell sort-header" onclick="setSort('age')">Age</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="8" class="text-center py-20 text-orange-700 font-mono animate-pulse">Scanning Solana Mempool...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="bg-[#451a03] p-4 border-t-2 border-[#7c2d12] flex justify-between items-center">
                <div class="text-xs text-[#9a3412] font-mono font-bold uppercase tracking-wider hidden md:block">
                    Showing results
                </div>
                <div class="flex items-center gap-4 mx-auto md:mx-0">
                    <button id="btn-prev" onclick="changePage(-1)" class="page-btn flex items-center gap-2" disabled>
                        <i data-lucide="chevron-left" width="16"></i> Previous
                    </button>
                    <span id="page-display" class="text-[#fb923c] font-mono font-bold text-lg">Page 1</span>
                    <button id="btn-next" onclick="changePage(1)" class="page-btn flex items-center gap-2">
                        Next <i data-lucide="chevron-right" width="16"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ABOUT VIEW -->
    <div id="view-about" class="view-section px-4">
        <div class="max-w-4xl mx-auto space-y-6">
            <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl p-8 shadow-2xl relative overflow-hidden">
                 <div class="absolute top-0 right-0 p-8 opacity-10 pointer-events-none">
                    <i data-lucide="flame" width="200" height="200"></i>
                </div>
                <h2 class="text-4xl font-bold mb-6 text-[#ea580c] tracking-tight">The Terminal Fire Explorer.</h2>
                <div class="space-y-4 text-lg text-[#ffedd5] leading-relaxed max-w-2xl">
                    <p>
                        <span class="font-bold text-white">HolDex</span> is a high-velocity, terminal-styled explorer for the Solana ecosystem. 
                        We don't just index tokens; we analyze conviction.
                    </p>
                    <p>
                        Using our proprietary <span class="text-[#fb923c] font-bold font-mono">K-Score Algorithm</span>, we rank tokens based on community engagement, 
                        holder distribution, and liquidity depth—not just price action.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <div class="feature-box">
                            <i data-lucide="zap" class="text-[#ea580c]" width="32"></i>
                            <h3 class="font-bold text-white text-xl">Real-Time Indexing</h3>
                            <p class="text-sm text-[#9a3412]">Direct integration with Solana RPCs means you see pools seconds after they launch.</p>
                        </div>
                        <div class="feature-box">
                            <i data-lucide="shield-check" class="text-[#ea580c]" width="32"></i>
                            <h3 class="font-bold text-white text-xl">Community Verified</h3>
                            <p class="text-sm text-[#9a3412]">Project owners can verify their social metadata on-chain, proving authenticity.</p>
                        </div>
                        <div class="feature-box">
                            <i data-lucide="bar-chart-2" class="text-[#ea580c]" width="32"></i>
                            <h3 class="font-bold text-white text-xl">K-Score Metric</h3>
                            <p class="text-sm text-[#9a3412]">A weighted score of social signals and on-chain health. Find the signal in the noise.</p>
                        </div>
                        <div class="feature-box">
                            <i data-lucide="code" class="text-[#ea580c]" width="32"></i>
                            <h3 class="font-bold text-white text-xl">Open API</h3>
                            <p class="text-sm text-[#9a3412]">Developers can access our indexed data freely. Build your own tools on top of HolDex.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center py-8">
                <button onclick="toggleApiModal()" class="text-[#9a3412] hover:text-[#fb923c] font-mono text-sm underline cursor-pointer">View Developer API Documentation</button>
            </div>
        </div>
    </div>
    
    <!-- UPDATE VIEW -->
    <div id="view-update" class="view-section px-4">
         <div class="max-w-2xl mx-auto">
            <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl p-6 md:p-8 shadow-2xl">
                <div class="flex items-center gap-4 mb-8">
                    <div class="w-12 h-12 rounded-xl bg-[#451a03] border-2 border-[#7c2d12] flex items-center justify-center text-[#ea580c]">
                        <i data-lucide="edit-3" width="24"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Community Update</h2>
                        <p class="text-[#9a3412] text-sm font-mono">Verify your token metadata on HolDex</p>
                    </div>
                </div>

                <div class="fee-card">
                    <p class="text-xs text-[#9a3412] uppercase font-bold mb-1">Update Cost</p>
                    <div class="flex justify-center gap-6 items-end">
                        <div class="text-center">
                            <span id="fee-sol" class="text-xl font-mono font-bold text-white">0.1 SOL</span>
                            <span class="block text-[10px] text-[#9a3412]">Platform Fee</span>
                        </div>
                        <div class="text-[#7c2d12] font-bold text-xl">+</div>
                        <div class="text-center">
                            <span id="fee-token" class="text-xl font-mono font-bold text-[#ea580c]">1,000 TOKENS</span>
                            <span class="block text-[10px] text-[#9a3412]">Burned from Supply</span>
                        </div>
                    </div>
                </div>

                <div id="wallet-connected" class="hidden mb-6">
                    <div class="bg-[#451a03] border border-[#7c2d12] rounded-xl p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]"></div>
                            <div>
                                <div class="text-xs text-[#9a3412] font-bold uppercase">Connected</div>
                                <div id="display-address" class="font-mono text-sm text-[#fb923c]"></div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-[#9a3412] font-bold uppercase">Balances</div>
                            <div class="flex gap-3 text-xs font-mono">
                                <span><span id="balance-sol" class="text-white">0.00</span> SOL</span>
                                <span class="text-[#7c2d12]">|</span>
                                <span><span id="balance-token" class="text-[#ea580c]">0</span> TOKENS</span>
                                <i id="refresh-icon" data-lucide="refresh-cw" width="12" class="cursor-pointer hover:text-white" onclick="refreshBalances()"></i>
                            </div>
                        </div>
                        <button onclick="disconnectWallet()" class="ml-4 text-xs text-red-400 hover:text-red-300 font-bold underline">Disconnect</button>
                    </div>
                </div>

                <div id="wallet-disconnected" class="mb-6">
                    <button onclick="openWalletModal()" class="w-full py-4 bg-[#ea580c] hover:bg-[#c2410c] text-white font-bold rounded-xl shadow-lg transition transform hover:scale-[1.01] flex items-center justify-center gap-2">
                        <i data-lucide="wallet" width="20"></i> Connect Wallet to Update
                    </button>
                </div>

                <form id="update-form" onsubmit="submitUpdate(event)" class="space-y-4">
                    <div>
                        <label class="form-label">Token Mint Address</label>
                        <div class="flex gap-2">
                            <input type="text" id="update-mint" class="form-input mb-0" placeholder="e.g. 7ey...123" required minlength="32" onchange="fetchTokenForUpdate(this.value)">
                            <div id="mint-check-spinner" class="hidden text-[#ea580c] animate-spin self-center"><i data-lucide="loader-2"></i></div>
                        </div>
                    </div>

                    <!-- PREVIEW BOX -->
                    <div id="token-preview-info" class="hidden bg-[#1a0a05] border border-[#7c2d12] rounded-xl p-4 flex items-center gap-4">
                        <img id="update-token-img" src="" class="w-12 h-12 rounded-lg border border-[#ea580c] bg-black">
                        <div>
                            <div id="update-token-name" class="font-bold text-white text-sm"></div>
                            <div id="update-token-ticker" class="text-xs text-[#fb923c] font-mono"></div>
                        </div>
                        <div class="ml-auto text-xs text-green-500 font-mono flex items-center gap-1">
                            <i data-lucide="check-circle" width="12"></i> Verified Mint
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Twitter / X URL <span class="text-[#7c2d12]">(Optional)</span></label>
                            <input type="url" id="update-twitter" class="form-input" placeholder="https://x.com/project">
                        </div>
                        <div>
                            <label class="form-label">Website URL <span class="text-[#7c2d12]">(Optional)</span></label>
                            <input type="url" id="update-website" class="form-input" placeholder="https://project.com">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Telegram URL <span class="text-[#7c2d12]">(Optional)</span></label>
                            <input type="url" id="update-telegram" class="form-input" placeholder="https://t.me/project">
                        </div>
                        <div>
                            <label class="form-label">Banner Image URL <span class="text-[#7c2d12]">(Optional)</span></label>
                            <input type="url" id="update-banner" class="form-input" placeholder="https://.../banner.jpg (16:9)">
                        </div>
                    </div>

                    <div>
                         <label class="form-label">Description <span class="text-[#7c2d12]">(Optional, Max 250 chars)</span></label>
                         <textarea id="update-description" class="form-input h-24 resize-none" maxlength="250" placeholder="Tell us about your project..."></textarea>
                         <div class="text-right text-[10px] text-[#9a3412] mt-1"><span id="char-count">0</span>/250</div>
                    </div>

                    <div class="flex gap-4 pt-4 border-t border-[#451a03]">
                        <button type="button" onclick="openPreview()" class="flex-1 py-3 bg-[#451a03] border-2 border-[#7c2d12] text-[#fb923c] font-bold rounded-xl hover:border-[#ea580c] hover:text-white transition">
                            Preview
                        </button>
                        <button type="submit" id="submit-btn" disabled class="flex-1 py-3 bg-[#22c55e] disabled:bg-[#451a03] disabled:text-[#7c2d12] text-black font-bold rounded-xl shadow-[0_0_15px_rgba(34,197,94,0.4)] hover:shadow-[0_0_25px_rgba(34,197,94,0.6)] transition disabled:shadow-none">
                            Pay & Submit
                        </button>
                    </div>
                </form>
                
                <div id="update-status" class="hidden"></div>
            </div>
        </div>
    </div>
    
    <!-- DETAIL VIEW -->
    <div id="view-detail" class="view-section px-4 pb-20">
        <div id="detail-loading" class="text-center py-40 text-[#ea580c] font-mono text-xl animate-pulse">
            Loading Token Data...
        </div>

        <div id="detail-content" style="display: none;" class="max-w-[1800px] mx-auto">
            <!-- Header Section -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- 1. Info Card -->
                <div class="lg:col-span-2 bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl p-6 shadow-xl relative overflow-hidden flex flex-col justify-between">
                    <div id="detail-banner-container" class="mb-6 hidden"></div>
                    
                    <div class="flex flex-col md:flex-row gap-6 relative z-10">
                        <div id="detail-media-container" class="flex-shrink-0"></div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-3 mb-1">
                                <h1 id="detail-ticker" class="text-4xl md:text-5xl font-bold text-white tracking-tighter font-sans"></h1>
                                <span id="detail-name" class="text-[#fb923c] bg-[#451a03] px-3 py-1 rounded-lg border border-[#7c2d12] text-sm font-bold"></span>
                            </div>
                            
                            <div class="flex items-center gap-2 mb-4 group cursor-pointer" onclick="copyMint()">
                                <span id="detail-mint" class="font-mono text-xs text-[#9a3412] group-hover:text-[#ea580c] transition"></span>
                                <i data-lucide="copy" width="12" class="text-[#7c2d12] group-hover:text-[#ea580c]"></i>
                            </div>

                            <p id="detail-desc" class="text-sm text-[#ffedd5] leading-relaxed max-w-2xl mb-6 hidden"></p>

                            <div id="detail-actions" class="flex flex-wrap gap-3"></div>
                        </div>
                    </div>
                </div>

                <!-- 2. Stats Grid -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="stat-card">
                        <span class="stat-label">Price USD</span>
                        <span id="stat-price" class="stat-value text-[#ea580c]">$0.00</span>
                    </div>
                    <div class="stat-card">
                        <div class="flex justify-between items-start">
                             <span class="stat-label">K-Score</span>
                             <i data-lucide="info" width="12" class="text-[#7c2d12] cursor-pointer hover:text-[#ea580c]" onclick="toggleInfoModal()"></i>
                        </div>
                        <span id="stat-kscore" class="stat-value">0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">Market Cap</span>
                        <span id="stat-mcap" class="stat-value">$0</span>
                    </div>
                     <div class="stat-card">
                        <span class="stat-label">24h Vol</span>
                        <span id="stat-vol" class="stat-value">$0</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">1h Change</span>
                        <span id="stat-chg1h" class="stat-value text-sm">-</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-label">24h Change</span>
                        <span id="stat-chg24h" class="stat-value text-sm">-</span>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-wrapper">
                <div class="chart-header">
                    <div class="flex items-center gap-4 overflow-x-auto no-scrollbar" id="pool-tabs-container">
                        <!-- Pool tabs injected here -->
                    </div>
                    <div class="flex items-center bg-[#1a0a05] rounded-lg p-1 border border-[#451a03]">
                        <button class="res-btn" id="res-1" onclick="setResolution('1')">1m</button>
                        <button class="res-btn" id="res-5" onclick="setResolution('5')">5m</button>
                        <button class="res-btn" id="res-15" onclick="setResolution('15')">15m</button>
                        <button class="res-btn active" id="res-60" onclick="setResolution('60')">1H</button>
                        <button class="res-btn" id="res-D" onclick="setResolution('D')">1D</button>
                    </div>
                </div>
                <div id="tv-chart"></div>
            </div>
        </div>
    </div>
    
    <!-- WALLET & MODALS -->
    <div id="wallet-modal" class="modal-overlay">
        <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl p-6 w-full max-w-sm shadow-2xl relative transform transition-all scale-100">
            <button onclick="closeWalletModal()" class="absolute top-4 right-4 text-[#9a3412] hover:text-[#ea580c]"><i data-lucide="x"></i></button>
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="wallet" class="text-[#ea580c]"></i> Connect Wallet</h3>
            <div class="space-y-3">
                <div onclick="connectProvider('phantom')" class="wallet-btn">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-[#551bf9] flex items-center justify-center text-white"><i data-lucide="ghost" width="20"></i></div>
                        <span>Phantom</span>
                    </div>
                    <div class="w-2 h-2 rounded-full bg-green-500 hidden" id="dot-phantom"></div>
                </div>
                <div onclick="connectProvider('solflare')" class="wallet-btn">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-[#fc7229] flex items-center justify-center text-white"><i data-lucide="sun" width="20"></i></div>
                        <span>Solflare</span>
                    </div>
                </div>
            </div>
            <p class="text-center text-xs text-[#9a3412] mt-6">By connecting, you agree to our Terms of Service.</p>
        </div>
    </div>

    <!-- PREVIEW MODAL -->
    <div id="preview-modal" class="modal-overlay">
        <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl w-full max-w-3xl shadow-2xl relative flex flex-col max-h-[90vh]">
            <div class="p-4 border-b border-[#7c2d12] flex justify-between items-center bg-[#451a03]">
                <h3 class="font-bold text-[#fb923c] flex items-center gap-2"><i data-lucide="eye"></i> Preview Listing</h3>
                <button onclick="closePreview()" class="text-[#9a3412] hover:text-[#ea580c]"><i data-lucide="x"></i></button>
            </div>
            <div id="preview-container" class="preview-content">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- INFO MODAL -->
    <div id="info-modal" class="modal-overlay" onclick="if(event.target === this) toggleInfoModal()">
        <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl p-6 w-full max-w-md shadow-2xl">
            <h3 class="text-xl font-bold text-[#ea580c] mb-4">What is K-Score?</h3>
            <p class="text-[#ffedd5] mb-4 text-sm leading-relaxed">
                The <span class="font-bold text-white">K-Score (Kinetic Score)</span> is HolDex's proprietary metric for measuring token conviction. It ranges from 0-100.
            </p>
            <ul class="space-y-2 mb-6 text-sm text-[#9a3412] font-mono">
                <li class="flex items-center gap-2"><i data-lucide="check" width="14" class="text-green-500"></i> Liquidity Depth & Lock Status</li>
                <li class="flex items-center gap-2"><i data-lucide="check" width="14" class="text-green-500"></i> Holder Distribution (No whales > 20%)</li>
                <li class="flex items-center gap-2"><i data-lucide="check" width="14" class="text-green-500"></i> Community Metadata Verification</li>
                <li class="flex items-center gap-2"><i data-lucide="check" width="14" class="text-green-500"></i> Volume/Market Cap Ratio</li>
            </ul>
            <button onclick="toggleInfoModal()" class="w-full py-2 bg-[#451a03] text-[#fb923c] border border-[#7c2d12] rounded-lg font-bold hover:bg-[#582206]">Got it</button>
        </div>
    </div>

    <!-- API DOCS MODAL -->
    <div id="api-docs-modal" class="modal-overlay" onclick="if(event.target === this) toggleApiModal()">
        <div class="bg-[#2a1005] border-2 border-[#7c2d12] rounded-2xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[85vh]">
            <div class="p-4 border-b border-[#7c2d12] flex justify-between items-center bg-[#451a03]">
                <h3 class="font-bold text-[#ea580c] font-mono">Developer API</h3>
                <button onclick="toggleApiModal()" class="text-[#9a3412] hover:text-[#ea580c]"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-6">
                <div>
                    <h4 class="text-white font-bold mb-2">Get Token List</h4>
                    <p class="text-sm text-[#9a3412] mb-2">Returns paginated list of indexed tokens with K-Scores.</p>
                    <div class="code-block">
                        <span class="text-green-400">GET</span> <span id="api-url-text">https://holdex.io/api/tokens?sort=kscore&page=1</span>
                        <button class="code-copy-btn" onclick="copyApiUrl()">Copy</button>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-2">Get Token Candles</h4>
                    <p class="text-sm text-[#9a3412] mb-2">OHLCV data for charting. Resolutions: 1, 5, 15, 60, D.</p>
                    <div class="code-block">
                        <span class="text-green-400">GET</span> <span>https://holdex.io/api/token/{mint}/candles?resolution=60</span>
                    </div>
                </div>
                <div class="info-box border-l-4 border-l-[#ea580c]">
                    <p>API is currently free for public use (Rate Limit: 60 req/min). Contact us for enterprise WebSocket access.</p>
                </div>
            </div>
        </div>
    </div>

</main>

<div class="status-bar">
    <div class="flex items-center gap-4">
        <button id="statusbar-wallet-btn" onclick="openWalletModal()" class="status-bar-btn">
            <i data-lucide="wallet" width="14"></i> <span class="hidden sm:inline">Connect Wallet</span><span class="sm:hidden">Wallet</span>
        </button>
        <div class="hidden md:flex items-center gap-2 text-xs font-mono text-[#9a3412]">
            <span>TPS: <span class="text-[#fb923c]">4,209</span></span>
            <span class="text-[#451a03]">|</span>
            <span>Ping: <span class="text-[#fb923c]">24ms</span></span>
        </div>
    </div>
    
    <div class="flex items-center gap-2" onclick="toggleStatusModal()" class="cursor-pointer">
        <span class="text-xs font-bold text-[#fb923c] uppercase tracking-wider hidden sm:block">System Operational</span>
        <div class="pulse-dot green"></div>
    </div>
</div>

<script>
    // --- Constants ---
    const API_URL = 'https://asdev-backend.onrender.com';
    const FALLBACK_BANNER = "https://images.squarespace-cdn.com/content/690b8c21384b3f1201c2650c/967ea61f-a88a-4497-81c2-5c67d3d06d9e/Gemini_Generated_Image_c82gwyc82gwyc82g.png?content-type=image%2Fpng";
    const TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');
    const ASSOCIATED_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');

    // SWITCH TO PUBLIC RPCs
    const RPC_ENDPOINTS = [
        "https://api.mainnet-beta.solana.com",
        "https://rpc.ankr.com/solana",
        "https://solana-api.projectserum.com"
    ];

    // --- State ---
    let currentSort = 'kscore'; // Default to K-Score
    let searchQuery = '';
    let pollingInterval;
    let isConnected = true;
    let isInfoModalOpen = false;
    let isApiModalOpen = false;
    let isWalletModalOpen = false;
    let currentPage = 1;
    let isVerifiedFilter = false;
    let isZeroVolHidden = true; // Default to Hidden
    let currentUpdateTokenData = null;
    let walletAddress = null;
    let walletProvider = null; 
    let feeConfig = { solFee: 0.1, tokenFee: 1000, tokenMint: '9zB5wRarXMj86MymwLumSKA1Dx35zPqqKfcZtK1Spump', treasury: 'H8sMJqC9X8rJ8W1a6VjFq7X5gZ5fX9x8x8x8x8x8x8' };
    
    // --- Chart State ---
    let chartInstance = null;
    let candleSeries = null;
    let currentMint = null;
    let currentResolution = '60';

    // --- Init ---
    window.onload = async () => {
        handleRoute();
        await fetchFees();
        lucide.createIcons();
        
        // Character counter listener
        const descInput = document.getElementById('update-description');
        const charCount = document.getElementById('char-count');
        if(descInput && charCount) {
            descInput.addEventListener('input', () => {
                charCount.innerText = descInput.value.length;
            });
        }
    };
    window.addEventListener('hashchange', handleRoute);

    // --- SCALABILITY FIX: Pause Polling when Tab Inactive ---
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            // Stop polling to save server resources
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
                console.log("⏸️ Tab hidden. Polling paused.");
            }
        } else {
            // Resume polling if on dashboard
            if ((window.location.hash === '' || window.location.hash === '#') && !pollingInterval) {
                fetchList();
                pollingInterval = setInterval(fetchList, 5000);
                console.log("▶️ Tab active. Polling resumed.");
            }
        }
    });

    // --- Chart Functions ---
    // FIXED: Cleanup Function
    function cleanupChart() {
        if (chartInstance) {
            chartInstance.remove(); // Destroy old chart
            chartInstance = null;
            candleSeries = null;
        }
        const chartEl = document.getElementById('tv-chart');
        if(chartEl) chartEl.innerHTML = ''; // Clear container
    }

    function initChart() {
        if (chartInstance) {
            const container = document.getElementById('tv-chart');
            if (container) {
                const rect = container.getBoundingClientRect();
                if (rect.width > 0 && rect.height > 0) {
                    chartInstance.applyOptions({ width: rect.width, height: rect.height });
                }
            }
            return;
        }

        const container = document.getElementById('tv-chart');
        if (!container) return;

        const rect = container.getBoundingClientRect();
        const width = rect.width > 0 ? rect.width : container.clientWidth;
        const height = rect.height > 0 ? rect.height : container.clientHeight;

        if (width === 0 || height === 0) return;

        chartInstance = LightweightCharts.createChart(container, {
            width: width,
            height: height,
            layout: { background: { type: 'solid', color: '#1a0a05' }, textColor: '#9a3412' },
            grid: { vertLines: { color: '#2a1005' }, horzLines: { color: '#2a1005' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            rightPriceScale: { borderColor: '#7c2d12' },
            timeScale: { borderColor: '#7c2d12', timeVisible: true, secondsVisible: false }
        });

        candleSeries = chartInstance.addCandlestickSeries({
            upColor: '#22c55e', downColor: '#ef4444', borderVisible: false, wickUpColor: '#22c55e', wickDownColor: '#ef4444'
        });
        
        new ResizeObserver(entries => {
            if (entries.length === 0 || entries[0].target !== container) return;
            const newRect = entries[0].contentRect;
            if (newRect.width > 0 && newRect.height > 0 && chartInstance) {
                 chartInstance.applyOptions({ width: newRect.width, height: newRect.height });
            }
        }).observe(container);
    }
    
    async function setResolution(res) {
        currentResolution = res;
        document.querySelectorAll('.res-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`res-${res}`).classList.add('active');
        if (currentMint) await fetchCandles(currentMint);
    }

    async function fetchCandles(mint) {
        if (!mint) return;
        currentMint = mint;
        initChart();
        if (!chartInstance || !candleSeries) {
            initChart();
            if (!chartInstance || !candleSeries) return;
        }

        try {
            const now = Math.floor(Date.now() / 1000);
            let from = now - (24 * 60 * 60);
            if (currentResolution === '1') from = now - (4 * 60 * 60); 
            if (currentResolution === 'D') from = now - (30 * 24 * 60 * 60);

            const endpoint = `${API_URL}/api/token/${mint}/candles?resolution=${currentResolution}&from=${from}&to=${now}&_=${Date.now()}`;
            const res = await fetch(endpoint);
            const data = await res.json();
            
            if (data.success && Array.isArray(data.candles) && candleSeries) {
                const cleanData = data.candles.map(c => ({
                    time: c.time,
                    open: parseFloat(c.open),
                    high: parseFloat(c.high),
                    low: parseFloat(c.low),
                    close: parseFloat(c.close)
                }));
                candleSeries.setData(cleanData);
                if (cleanData.length > 0) chartInstance.timeScale().fitContent();
            } else if (candleSeries) {
                candleSeries.setData([]);
            }
        } catch (e) { console.error("Chart Fetch Failed", e); }
    }

    async function fetchFees() {
        try {
            const res = await fetch(`${API_URL}/api/config/fees`);
            const data = await res.json();
            if (data.success) {
                feeConfig = data;
                const solEl = document.getElementById('fee-sol');
                const tokEl = document.getElementById('fee-token');
                if (solEl) solEl.innerText = `${data.solFee} SOL`;
                if (tokEl) tokEl.innerText = `${data.tokenFee.toLocaleString()} TOKENS`;
            }
        } catch (e) { console.error("Fee fetch failed", e); }
    }

    function sanitizeInput(str) {
        if(!str) return '';
        const div = document.createElement('div');
        div.innerText = str;
        return div.innerHTML;
    }

    function openWalletModal() { document.getElementById('wallet-modal')?.classList.add('open'); isWalletModalOpen = true; }
    function closeWalletModal() { document.getElementById('wallet-modal')?.classList.remove('open'); isWalletModalOpen = false; }

    async function connectProvider(providerName) {
        let provider = null;
        if (providerName === 'phantom' && window.solana && window.solana.isPhantom) provider = window.solana;
        else if (providerName === 'solflare' && window.solflare) provider = window.solflare;

        if (!provider) { alert(`${providerName} not found.`); return; }

        try {
            const resp = await provider.connect();
            walletAddress = resp.publicKey.toString();
            walletProvider = provider;
            closeWalletModal();
            updateWalletUI(true);
            refreshBalances();
        } catch (err) { console.error("Connection Failed:", err); alert("Connection denied or failed."); }
    }

    function disconnectWallet() {
        if (walletProvider && walletProvider.disconnect) walletProvider.disconnect();
        walletAddress = null; walletProvider = null;
        updateWalletUI(false);
    }

    function updateWalletUI(connected) {
        const discDiv = document.getElementById('wallet-disconnected');
        const connDiv = document.getElementById('wallet-connected');
        const submitBtn = document.getElementById('submit-btn');
        const statusBtn = document.getElementById('statusbar-wallet-btn');
        const displayAddr = document.getElementById('display-address');

        if (connected) {
            const shortAddr = walletAddress.slice(0,4) + '...' + walletAddress.slice(-4);
            if (discDiv) discDiv.classList.add('hidden');
            if (connDiv) connDiv.classList.remove('hidden');
            if (displayAddr) displayAddr.innerText = shortAddr;
            if (submitBtn) submitBtn.disabled = false;
            if (statusBtn) {
                statusBtn.innerHTML = `<i data-lucide="wallet" width="14"></i> <span>${shortAddr}</span>`;
                statusBtn.classList.add('connected');
            }
        } else {
            if (discDiv) discDiv.classList.remove('hidden');
            if (connDiv) connDiv.classList.add('hidden');
            if (submitBtn) submitBtn.disabled = true;
            if (statusBtn) {
                statusBtn.innerHTML = `<i data-lucide="wallet" width="14"></i> <span class="hidden sm:inline">Connect Wallet</span><span class="sm:hidden">Wallet</span>`;
                statusBtn.classList.remove('connected');
            }
        }
        lucide.createIcons();
    }

    async function refreshBalances() {
        if (!walletAddress) return;
        const icon = document.getElementById('refresh-icon');
        if (icon) icon.classList.add('animate-spin');
        try {
            const tokenMint = feeConfig.tokenMint || '9zB5wRarXMj86MymwLumSKA1Dx35zPqqKfcZtK1Spump';
            const res = await fetch(`${API_URL}/api/proxy/balance/${walletAddress}?tokenMint=${tokenMint}`);
            const data = await res.json();
            const solEl = document.getElementById('balance-sol');
            const tokEl = document.getElementById('balance-token');
            if (data.success) {
                if(solEl) solEl.innerText = (data.sol || 0).toFixed(4);
                if(tokEl) tokEl.innerText = (data.tokens || 0).toLocaleString();
            } else { if(solEl) solEl.innerText = "Err"; if(tokEl) tokEl.innerText = "Err"; }
        } catch (e) { console.error("Balance Refresh Failed", e); } finally { if (icon) setTimeout(() => icon.classList.remove('animate-spin'), 500); }
    }

    async function submitUpdate(e) {
        e.preventDefault();
        if (!walletAddress || !walletProvider) { alert("Please connect wallet first"); return; }
        const statusDiv = document.getElementById('update-status');
        const mint = document.getElementById('update-mint').value;
        const twitter = document.getElementById('update-twitter').value;
        const website = document.getElementById('update-website').value;
        const telegram = document.getElementById('update-telegram').value;
        const banner = document.getElementById('update-banner').value;
        const descInput = document.getElementById('update-description');
        const description = descInput ? sanitizeInput(descInput.value.substring(0, 250)) : '';

        if (banner && !banner.match(/\.(jpeg|jpg|gif|png|webp)$/i)) {
            statusDiv.innerText = "❌ Error: Banner URL must end in .jpg, .png, .gif, or .webp";
            statusDiv.className = "mt-4 text-center text-sm font-mono text-red-500";
            return;
        }

        statusDiv.innerText = "Initializing Transaction...";
        statusDiv.className = "mt-4 text-center text-sm font-mono text-[#ea580c]";
        statusDiv.classList.remove('hidden');

        try {
            let connection, blockhash;
            for (const endpoint of RPC_ENDPOINTS) {
                try {
                    const conn = new solanaWeb3.Connection(endpoint, "confirmed");
                    const latest = await conn.getLatestBlockhash();
                    connection = conn; blockhash = latest.blockhash;
                    break; 
                } catch (err) {}
            }
            if (!connection) throw new Error("RPCs busy. Try later.");
            
            const fromPubkey = new solanaWeb3.PublicKey(walletAddress);
            const toPubkey = new solanaWeb3.PublicKey(feeConfig.treasury);
            const tokenMintPubkey = new solanaWeb3.PublicKey(feeConfig.tokenMint);

            const getATA = async (owner, mint) => {
                const [addr] = await solanaWeb3.PublicKey.findProgramAddress(
                    [owner.toBytes(), TOKEN_PROGRAM_ID.toBytes(), mint.toBytes()],
                    ASSOCIATED_TOKEN_PROGRAM_ID
                );
                return addr;
            };

            const fromTokenAccount = await getATA(fromPubkey, tokenMintPubkey);
            const toTokenAccount = await getATA(toPubkey, tokenMintPubkey);

            statusDiv.innerText = "Building Transaction...";
            const transaction = new solanaWeb3.Transaction();

            transaction.add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: fromPubkey,
                    toPubkey: toPubkey,
                    lamports: Math.round(feeConfig.solFee * solanaWeb3.LAMPORTS_PER_SOL)
                })
            );

            const decimals = 6;
            const rawAmount = BigInt(Math.floor(feeConfig.tokenFee * Math.pow(10, decimals)));
            const dataLayout = new Uint8Array(9);
            dataLayout[0] = 3; 
            let remaining = rawAmount;
            for (let i = 0; i < 8; i++) { dataLayout[i + 1] = Number(remaining & 0xFFn); remaining >>= 8n; }

            const transferIx = new solanaWeb3.TransactionInstruction({
                keys: [
                    { pubkey: fromTokenAccount, isSigner: false, isWritable: true },
                    { pubkey: toTokenAccount, isSigner: false, isWritable: true },
                    { pubkey: fromPubkey, isSigner: true, isWritable: false } 
                ],
                programId: TOKEN_PROGRAM_ID, data: dataLayout
            });
            transaction.add(transferIx);
            transaction.recentBlockhash = blockhash;
            transaction.feePayer = fromPubkey;

            statusDiv.innerText = "Please Sign in Wallet...";
            const { signature } = await walletProvider.signAndSendTransaction(transaction);
            
            statusDiv.innerText = "Verifying Payment...";
            const payload = { mint, twitter, website, telegram, banner, description, signature: signature, userPublicKey: walletAddress };

            const res = await fetch(`${API_URL}/api/request-update`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const dataRes = await res.json();
            
            if (dataRes.success) {
                statusDiv.innerText = "✅ Success! Update queued.";
                statusDiv.className = "mt-4 text-center text-sm font-mono text-green-500";
                e.target.reset();
                document.getElementById('char-count').innerText = "0";
            } else {
                statusDiv.innerText = `❌ Verification Failed: ${dataRes.error}`;
                statusDiv.className = "mt-4 text-center text-sm font-mono text-red-500";
            }
        } catch (err) {
            console.error(err);
            statusDiv.innerText = `❌ Error: ${err.message}`;
            statusDiv.className = "mt-4 text-center text-sm font-mono text-red-500";
        }
    }

    const formatMoney = (val) => { if (val === undefined || val === null || isNaN(val)) return "$0.00"; return val < 0.01 ? '$' + val.toExponential(2) : '$' + val.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 }); };
    const formatCompact = (val) => { if (val === undefined || val === null || isNaN(val)) return "$0"; return '$' + new Intl.NumberFormat('en-US', { notation: "compact", maximumFractionDigits: 1 }).format(val); };
    const formatPct = (val) => { if (val === undefined || val === null || isNaN(val) || val === 0) return `<span class="text-[#9a3412]">-</span>`; const cls = val > 0 ? 'pill-green' : (val < 0 ? 'pill-red' : 'text-[#9a3412]'); return `<span class="pill ${cls}">${val > 0 ? '+' : ''}${val.toFixed(2)}%</span>`; };
    const timeAgo = (ts) => { if (!ts) return ''; const seconds = Math.floor((Date.now() - ts) / 1000); return seconds < 60 ? `${seconds}s ago` : (seconds < 3600 ? `${Math.floor(seconds/60)}m ago` : `${Math.floor(seconds/3600)}h ago`); };

    function renderTokenMedia(url, className, fallbackText = '?') {
        const fallback = `https://placehold.co/80x80/2a1005/7c2d12?text=${fallbackText}`;
        const safeUrl = url || fallback;
        const isVideo = safeUrl.match(/\.(mp4|webm|mov)$/i);
        if (isVideo) { return `<video src="${safeUrl}" class="${className}" autoplay loop muted playsinline poster="${fallback}"></video>`; }
        return `<img src="${safeUrl}" class="${className}" loading="lazy" onerror="this.onerror=null;this.src='${fallback}'">`;
    }

    function navigateTo(path) { window.location.hash = path; }
    
    function handleRoute() {
        const hash = window.location.hash;
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        const tableControls = document.getElementById('table-controls');
        const detailControls = document.getElementById('detail-controls');
        if (tableControls) tableControls.classList.add('hidden');
        if (detailControls) detailControls.classList.add('hidden');
        if (pollingInterval) { clearInterval(pollingInterval); pollingInterval = null; }

        if (hash === '' || hash === '#') {
            const el = document.getElementById('view-dashboard');
            const btn = document.querySelector('button[onclick="navigateTo(\'\')"]');
            if(el) el.classList.add('active');
            if(btn) btn.classList.add('active');
            if(tableControls) tableControls.classList.remove('hidden');
            fetchList();
            pollingInterval = setInterval(fetchList, 5000);
        } else if (hash === '#about') {
            const el = document.getElementById('view-about');
            const btn = document.querySelector('button[onclick="navigateTo(\'about\')"]');
            if(el) el.classList.add('active');
            if(btn) btn.classList.add('active');
        } else if (hash === '#update') {
            const el = document.getElementById('view-update');
            const btn = document.querySelector('button[onclick="navigateTo(\'update\')"]');
            if(el) el.classList.add('active');
            if(btn) btn.classList.add('active');
            updateWalletUI(walletAddress !== null);
        } else if (hash.startsWith('#token/')) {
            showDetailView(hash.split('/')[1]);
        }
    }

    async function fetchTokenForUpdate(mint) {
        if (!mint || mint.length < 30) return;
        const spinner = document.getElementById('mint-check-spinner');
        const infoBox = document.getElementById('token-preview-info');
        if(spinner) spinner.classList.remove('hidden'); 
        if(infoBox) infoBox.classList.add('hidden');
        try {
            const res = await fetch(`${API_URL}/api/tokens?search=${mint}&limit=1`);
            const data = await res.json();
            if (data.success && data.tokens.length > 0) {
                const token = data.tokens[0];
                if (token.mint === mint) {
                    currentUpdateTokenData = token;
                    const img = document.getElementById('update-token-img');
                    const name = document.getElementById('update-token-name');
                    const tick = document.getElementById('update-token-ticker');
                    if(img) img.src = token.image || 'https://placehold.co/50';
                    if(name) name.innerText = token.name;
                    if(tick) tick.innerText = token.ticker;
                    if(infoBox) infoBox.classList.remove('hidden');
                }
            }
        } catch (e) { console.error("Fetch failed", e); } finally { if(spinner) spinner.classList.add('hidden'); }
    }

    function openPreview() {
        if (!currentUpdateTokenData) { alert("Please enter a valid Mint Address first."); return; }
        const banner = document.getElementById('update-banner').value;
        const twitter = document.getElementById('update-twitter').value;
        const website = document.getElementById('update-website').value;
        const telegram = document.getElementById('update-telegram').value;
        const t = { ...currentUpdateTokenData, banner, twitter, website, telegram, hasCommunityUpdate: true };
        const container = document.getElementById('preview-container');
        let html = '';
        if (t.banner) { html += `<div class="w-full h-48 md:h-64 rounded-xl border-2 border-[#7c2d12] shadow-lg relative overflow-hidden bg-black mb-6"><img src="${t.banner}" class="w-full h-full object-cover object-center" onerror="this.src='${FALLBACK_BANNER}'"><div class="absolute inset-0 bg-gradient-to-t from-[#2a1005] to-transparent opacity-80 pointer-events-none"></div></div>`; }
        let linksHtml = '';
        if (t.twitter) linksHtml += `<a href="#" class="social-btn"><i data-lucide="twitter" width="20"></i></a>`;
        if (t.website) linksHtml += `<a href="#" class="social-btn"><i data-lucide="globe" width="20"></i></a>`;
        if (t.telegram) linksHtml += `<a href="#" class="social-btn"><i data-lucide="send" width="20"></i></a>`;
        const mediaHtml = renderTokenMedia(t.image, "w-20 h-20 rounded-xl border-2 border-[#ea580c] object-cover bg-black");
        html += `<div class="flex flex-col md:flex-row gap-6 mb-8 items-start"><div class="flex items-center gap-6 w-full md:w-auto bg-[#451a03] p-4 rounded-2xl border-2 border-[#7c2d12] shadow-xl">${mediaHtml}<div class="flex-1 min-w-0"><div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-3 mb-1"><h2 class="text-3xl font-bold text-white tracking-tight font-mono">${t.ticker}</h2><span class="text-[#fb923c] text-sm bg-[#2a1005] px-3 py-1 rounded-lg border border-[#7c2d12]">${t.name}</span></div><div class="text-xs text-[#9a3412] font-mono">${t.mint}</div></div></div><div class="flex-1"></div><div class="flex flex-wrap gap-3">${linksHtml}</div></div><div class="text-center text-[#9a3412] font-mono text-xs mt-10">-- End of Preview --</div>`;
        if(container) container.innerHTML = html;
        lucide.createIcons();
        document.getElementById('preview-modal')?.classList.add('open');
    }

    function closePreview() { document.getElementById('preview-modal')?.classList.remove('open'); }
    function toggleInfoModal() { const modal = document.getElementById('info-modal'); isInfoModalOpen = !isInfoModalOpen; if (isInfoModalOpen) modal.classList.add('open'); else modal.classList.remove('open'); }
    
    function toggleVerifiedFilter() { isVerifiedFilter = !isVerifiedFilter; const btn = document.getElementById('filter-verified'); if(btn) { if (isVerifiedFilter) btn.classList.add('active'); else btn.classList.remove('active'); } currentPage = 1; fetchList(); }
    function toggleZeroVolFilter() { isZeroVolHidden = !isZeroVolHidden; const btn = document.getElementById('filter-zerovol'); if(btn) { if (isZeroVolHidden) btn.classList.add('active'); else btn.classList.remove('active'); } currentPage = 1; fetchList(); }
    
    async function fetchList() {
        try {
            const pDisplay = document.getElementById('page-display');
            const prev = document.getElementById('btn-prev');
            const next = document.getElementById('btn-next');
            if(pDisplay) pDisplay.innerText = `Page ${currentPage}`;
            if(prev) prev.disabled = currentPage <= 1;
            
            let endpoint = `${API_URL}/api/tokens?sort=${currentSort}&search=${encodeURIComponent(searchQuery)}&limit=100&page=${currentPage}`;
            if (isVerifiedFilter) endpoint += '&filter=verified';
            const res = await fetch(endpoint);
            const data = await res.json();
            if (data.success) {
                const syncEl = document.getElementById('last-sync-time');
                if (syncEl && data.lastUpdate) syncEl.innerText = new Date(data.lastUpdate).toLocaleTimeString();
                renderTable(data.tokens);
                if(next) next.disabled = data.tokens.length < 100;
            }
        } catch (e) { console.error("API Connection Failed", e); }
    }

    function changePage(delta) {
        currentPage += delta; if (currentPage < 1) currentPage = 1;
        if (pollingInterval) clearInterval(pollingInterval);
        const tbody = document.getElementById('table-body');
        if(tbody) tbody.innerHTML = `<tr><td colspan="8" class="text-center py-20 text-orange-700 font-mono animate-pulse">Loading Page ${currentPage}...</td></tr>`;
        fetchList().then(() => { if (currentPage === 1) { pollingInterval = setInterval(fetchList, 5000); } });
    }

    function renderTable(tokens) {
        const tbody = document.getElementById('table-body');
        if(!tbody) return;
        let displayTokens = tokens;
        if (isZeroVolHidden) { displayTokens = tokens.filter(t => (t.volume24h || 0) > 0); }
        if (displayTokens.length === 0) { tbody.innerHTML = `<tr><td colspan="8" class="text-center py-20 text-[#9a3412] font-mono">${searchQuery ? `Searching global network for "${searchQuery}"...` : 'No tokens found.'}</td></tr>`; return; }

        tbody.innerHTML = displayTokens.map(t => {
            const score = t.kScore || 0;
            const isVerified = t.hasCommunityUpdate;
            const mcap = Number(t.marketCap || 0);
            const vol = Number(t.volume24h || 0);
            let kScoreDisplay;
            if (isVerified) {
                if (score > 0) { kScoreDisplay = `${score}${score > 50 ? ' 💎' : ''}`; } else { kScoreDisplay = `<span title="Calculating Score..." class="animate-pulse">🕒</span>`; }
            } else { kScoreDisplay = '<span title="Community Update Required" class="text-gray-500">🔒</span>'; }
            const mediaHtml = renderTokenMedia(t.image, "img-token group-hover:border-[#ea580c] transition");

            return `
            <tr onclick="navigateTo('token/${t.mint}')" class="cursor-pointer group">
                <td><div class="flex items-center gap-3">${mediaHtml}<div class="flex flex-col min-w-0"><div class="flex items-center gap-2"><span class="font-bold text-white text-sm group-hover:text-[#ea580c] transition truncate font-sans tracking-wide">${t.ticker}</span>${isVerified ? '<span title="Verified Community Update" class="verified-badge"><i data-lucide="check" width="12"></i></span>' : ''}</div><span class="text-[10px] text-[#9a3412] truncate max-w-[120px] md:max-w-[200px] font-mono group-hover:text-[#fb923c]">${t.name}</span></div></div></td>
                <td class="text-right text-[#fb923c] font-mono font-bold">${kScoreDisplay}</td>
                <td class="hidden md:table-cell text-right">${formatPct(t.change5m)}</td>
                <td class="hidden md:table-cell text-right">${formatPct(t.change1h)}</td>
                <td class="text-right">${formatPct(t.change24h)}</td>
                <td class="text-right font-mono text-[#fb923c] font-bold">${formatCompact(mcap)}</td>
                <td class="text-right font-mono text-[#22c55e]">${formatCompact(vol)}</td>
                <td class="hidden md:table-cell text-right text-xs text-[#9a3412] font-mono">${timeAgo(t.timestamp)}</td>
            </tr>
        `}).join('');
        lucide.createIcons();
    }

    window.switchPool = (pairAddress, dexId) => {
        document.querySelectorAll('.pool-tab').forEach(t => t.classList.remove('active')); const tab = document.getElementById(`tab-${pairAddress}`); if(tab) tab.classList.add('active');
    };

    async function showDetailView(mint) {
        clearInterval(pollingInterval); pollingInterval = null;
        const db = document.getElementById('view-dashboard');
        const dt = document.getElementById('view-detail');
        const ab = document.getElementById('view-about');
        const up = document.getElementById('view-update');
        const dc = document.getElementById('detail-controls');
        if(db) db.classList.remove('active');
        if(ab) ab.classList.remove('active');
        if(up) up.classList.remove('active');
        if(dt) dt.classList.add('active');
        if(dc) dc.classList.remove('hidden');

        const loadingDiv = document.getElementById('detail-loading');
        const contentDiv = document.getElementById('detail-content');
        const bannerContainer = document.getElementById('detail-banner-container');
        if(loadingDiv) loadingDiv.style.display = 'block'; 
        if(contentDiv) contentDiv.style.display = 'none'; 
        if(bannerContainer) { bannerContainer.classList.add('hidden'); bannerContainer.innerHTML = ''; }
        cleanupChart();

        try {
            const res = await fetch(`${API_URL}/api/token/${mint}`);
            const data = await res.json();
            if (data.success) {
                const t = data.token;
                const ticker = document.getElementById('detail-ticker');
                const name = document.getElementById('detail-name');
                const mintEl = document.getElementById('detail-mint');
                const descEl = document.getElementById('detail-desc');
                const mediaContainer = document.getElementById('detail-media-container');
                if (mediaContainer) { mediaContainer.innerHTML = renderTokenMedia(t.image, "w-20 h-20 rounded-xl border-2 border-[#ea580c] object-cover bg-black shadow-lg"); }
                if(ticker) ticker.innerText = t.ticker;
                if(name) name.innerText = t.name;
                if(mintEl) mintEl.innerText = t.mint;
                
                const isVerified = t.hasCommunityUpdate;
                if (t.description && descEl && isVerified) { descEl.innerHTML = sanitizeInput(t.description); descEl.classList.remove('hidden'); } else if (descEl) { descEl.classList.add('hidden'); }
                if (t.banner && bannerContainer) { bannerContainer.innerHTML = `<div class="w-full h-48 md:h-64 rounded-xl border-2 border-[#7c2d12] shadow-lg relative overflow-hidden bg-black"><img src="${t.banner}" class="w-full h-full object-cover object-center" onerror="this.src='${FALLBACK_BANNER}'"><div class="absolute inset-0 bg-gradient-to-t from-[#2a1005] to-transparent opacity-80 pointer-events-none"></div></div>`; bannerContainer.classList.remove('hidden'); }

                const actionsDiv = document.getElementById('detail-actions'); 
                if(actionsDiv) {
                    let linksHtml = '';
                    linksHtml += `<a href="https://jup.ag/swap?sell=So11111111111111111111111111111111111111112&buy=${t.mint}" target="_blank" class="action-btn flex items-center justify-center gap-2 flex-grow bg-[#191e29] border-[#c7f284] text-[#c7f284] hover:bg-[#c7f284] hover:text-[#000]">Jupiter Swap</a>`;
                    linksHtml += `<a href="https://solscan.io/token/${t.mint}" target="_blank" class="action-btn flex items-center justify-center gap-2 flex-grow"><i data-lucide="search" width="16"></i> Solscan</a>`;
                    if (isVerified) {
                        linksHtml += `<div class="flex items-center px-4 py-2 bg-green-900/30 border border-green-500 text-green-500 rounded-xl font-bold uppercase text-xs tracking-wider h-14"><i data-lucide="shield-check" width="18" class="mr-2"></i> VERIFIED UPDATE</div>`;
                        if (t.twitter) linksHtml += `<a href="${t.twitter}" target="_blank" class="social-btn-lg"><i data-lucide="twitter" width="24"></i></a>`;
                        if (t.website) linksHtml += `<a href="${t.website}" target="_blank" class="social-btn-lg"><i data-lucide="globe" width="24"></i></a>`;
                        if (t.telegram) linksHtml += `<a href="${t.telegram}" target="_blank" class="social-btn-lg"><i data-lucide="send" width="24"></i></a>`;
                    }
                    actionsDiv.innerHTML = linksHtml; lucide.createIcons();
                }

                const mcap = Number(t.marketCap || 0);
                const price = Number(t.priceUsd || 0);
                const vol = Number(t.volume24h || 0);
                const score = t.kScore || 0;

                const sPrice = document.getElementById('stat-price'); if(sPrice) sPrice.innerText = formatMoney(price);
                const sMcap = document.getElementById('stat-mcap'); if(sMcap) sMcap.innerText = formatCompact(mcap);
                const sVol = document.getElementById('stat-vol'); if(sVol) sVol.innerText = formatCompact(vol);
                const s1h = document.getElementById('stat-chg1h'); if(s1h) s1h.innerHTML = formatPct(t.change1h);
                const s24h = document.getElementById('stat-chg24h'); if(s24h) s24h.innerHTML = formatPct(t.change24h);
                
                const kEl = document.getElementById('stat-kscore');
                if(kEl) {
                    if (isVerified) {
                        if (score > 0) { kEl.innerText = score; kEl.classList.remove('text-gray-500'); kEl.classList.add('text-[#fb923c]'); kEl.title = "Conviction Score"; } 
                        else { kEl.innerText = '🕒'; kEl.classList.remove('text-gray-500', 'text-[#fb923c]'); kEl.classList.add('text-[#fb923c]', 'animate-pulse'); kEl.title = "Calculating Score..."; }
                    } else { kEl.innerText = '🔒'; kEl.classList.remove('text-[#fb923c]', 'animate-pulse'); kEl.classList.add('text-gray-500'); kEl.title = "Requires Community Update"; }
                }

                const tabsContainer = document.getElementById('pool-tabs-container'); 
                if(tabsContainer) {
                    tabsContainer.innerHTML = '';
                    if (t.pairs && t.pairs.length > 0) {
                        t.pairs.forEach((pair, idx) => {
                            if (!pair) return;
                            const tab = document.createElement('div'); 
                            tab.className = `pool-tab ${idx === 0 ? 'active' : ''}`;
                            let dexId = "UNKNOWN"; if (pair.dexId) dexId = String(pair.dexId);
                            const dexName = dexId.toUpperCase();
                            tab.id = `tab-${pair.pairAddress}`; 
                            tab.innerText = `${dexName} ($${formatCompact(pair.liquidity)})`;
                            tab.onclick = () => switchPool(pair.pairAddress, pair.dexId); 
                            tabsContainer.appendChild(tab);
                        });
                    }
                }
                if(loadingDiv) loadingDiv.style.display = 'none'; 
                if(contentDiv) contentDiv.style.display = 'block';
                setTimeout(async () => { await fetchCandles(mint); }, 100);
            }
        } catch (e) { console.error(e); if(loadingDiv) loadingDiv.innerText = "Error Loading Token Data"; }
    }

    window.setSort = (sort, btn) => { currentSort = sort; currentPage = 1; fetchList(); };
    window.handleSearch = (e) => { 
        searchQuery = e.target.value; 
        const clearBtn = document.getElementById('clear-search-btn');
        if (searchQuery.length > 0) { clearBtn.style.display = 'block'; } else { clearBtn.style.display = 'none'; }
        currentPage = 1; clearTimeout(window.searchTimeout); window.searchTimeout = setTimeout(fetchList, 1000); 
    };
    window.clearSearch = () => {
        document.getElementById('search').value = '';
        searchQuery = '';
        document.getElementById('clear-search-btn').style.display = 'none';
        currentPage = 1; fetchList();
    };

    window.copyMint = () => { const el = document.getElementById('detail-mint'); if(el) navigator.clipboard.writeText(el.innerText); };
    window.handleManualRefresh = () => { fetchList(); };
    lucide.createIcons();
    
    window.toggleStatusModal = () => {
        const modal = document.getElementById('status-modal');
        if(modal) { if(modal.style.opacity === '1' || modal.classList.contains('open')) { modal.classList.remove('open'); modal.style.opacity = '0'; modal.style.pointerEvents = 'none'; } else { modal.classList.add('open'); modal.style.opacity = '1'; modal.style.pointerEvents = 'auto'; } }
    }
    window.toggleApiModal = () => { const modal = document.getElementById('api-docs-modal'); isApiModalOpen = !isApiModalOpen; if (isApiModalOpen) modal.classList.add('open'); else modal.classList.remove('open'); }
    window.copyApiUrl = () => { const text = document.getElementById('api-url-text').innerText; navigator.clipboard.writeText(text).then(() => { const btn = document.querySelector('.code-copy-btn'); const original = btn.innerText; btn.innerText = "Copied!"; setTimeout(() => btn.innerText = original, 2000); }); }
</script>
</body>
</html>
